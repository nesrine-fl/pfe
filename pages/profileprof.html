<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Profil de l'utilisateur</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- Informations personnelles -->
  <section class="personal-info">
    <h2>Informations personnelles</h2>
    <div class="info-fields">
      <input type="text" id="nom" placeholder="Nom" />
      <input type="text" id="prenom" placeholder="Pr√©nom" />
      <input type="email" id="email" placeholder="Email" />
      <input type="tel" id="telephone" placeholder="T√©l√©phone" />
      <input type="text" id="departement" placeholder="D√©partement" />
      <input type="text" id="fonction" placeholder="Fonction" />
    </div>
  </section>

  <!-- Statistiques globales -->
  <section class="global-stats">
    <h2>Statistiques globales</h2>
    <div class="stats">
      <p>Total de cours suivis : <span id="totalCourses">0</span></p>
      <p>Cours compl√©t√©s : <span id="completedCourses">0</span></p>
      <p>Progression moyenne : <span id="averageProgress">0%</span></p>
    </div>
  </section>

  <!-- Liste des cours suivis -->
  <section class="followed-courses">
    <h2>Liste des cours suivis</h2>
    <table>
      <thead>
        <tr>
          <th>Nom du cours</th>
          <th>Progression</th>
          <th>Date de d√©but</th>
          <th>Date de fin</th>
          <th>Statut</th>
        </tr>
      </thead>
      <tbody id="courseTableBody">
        <!-- Les lignes seront ajout√©es dynamiquement ici -->
      </tbody>
    </table>
  </section>

  <!-- Comp√©tences acquises -->
  <section class="skills">
    <h2>Comp√©tences acquises</h2>
    <ul id="skillsList">
      <!-- Les comp√©tences seront ajout√©es ici -->
    </ul>
  </section>

  <!-- JavaScript pour remplir dynamiquement les donn√©es -->
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const token = localStorage.getItem('token');
      if (!token) return;

      try {
        const response = await fetch('http://localhost:8000/api/profile', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });

        if (!response.ok) throw new Error('Erreur lors du chargement du profil');

        const data = await response.json();

        // üë§ Infos personnelles
        document.getElementById('nom').value = data.nom || '';
        document.getElementById('prenom').value = data.prenom || '';
        document.getElementById('email').value = data.email || '';
        document.getElementById('telephone').value = data.telephone || '';
        document.getElementById('departement').value = data.departement || '';
        document.getElementById('fonction').value = data.fonction || '';

        // üìä Statistiques
        document.getElementById('totalCourses').textContent = data.total_courses || 0;
        document.getElementById('completedCourses').textContent = data.completed_courses || 0;
        document.getElementById('averageProgress').textContent = (data.average_progress || 0) + '%';

        // üìö Cours suivis
        const tableBody = document.getElementById('courseTableBody');
        tableBody.innerHTML = ''; // Reset
        data.courses.forEach(course => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${course.name}</td>
            <td>${course.progress}%</td>
            <td>${course.start_date}</td>
            <td>${course.end_date}</td>
            <td>${course.status}</td>
          `;
          tableBody.appendChild(row);
        });

        // üéØ Comp√©tences
        const skillsList = document.getElementById('skillsList');
        skillsList.innerHTML = ''; // Reset
        data.skills.forEach(skill => {
          const li = document.createElement('li');
          li.textContent = skill;
          skillsList.appendChild(li);
        });

      } catch (error) {
        console.error(error);
      }
    });
  </script>

</body>
</html>
